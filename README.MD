# ğŸ” Proxmox Backup Checker

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![Code Quality & Security](https://github.com/jokrEZ/proxmox-backup-checker/actions/workflows/python-app.yml/badge.svg)](https://github.com/jokrEZ/proxmox-backup-checker/actions/workflows/python-app.yml)
[![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg)](http://makeapullrequest.com)

**Intelligente Ãœberwachung von Proxmox VE Backup-Jobs mit Home Assistant Integration**

Automatische PrÃ¼fung deiner Proxmox-Backups basierend auf den konfigurierten ZeitplÃ¤nen - nur echte Probleme werden gemeldet, keine false positives!

## âœ¨ Features

- ğŸ• **Zeitplan-bewusste PrÃ¼fung** - Respektiert individuelle Backup-Schedules (tÃ¤glich/wÃ¶chentlich)
- ğŸ” **Intelligente Log-Analyse** - Erkennt echte Backup-Fehler in Logdateien
- ğŸ  **Home Assistant Integration** - Webhook-Benachrichtigungen bei Problemen
- ğŸ“ **VM/CT-Namen-AuflÃ¶sung** - Zeigt aussagekrÃ¤ftige Namen statt nur IDs
- ğŸ› **Umfassender Debug-Modus** - Detaillierte Informationen fÃ¼r Troubleshooting
- âš¡ **Einfache Installation** - Als Python Package oder Git Repository

## ğŸš€ Quick Start

```bash
# Einfachste Installation
pip install git+https://github.com/jokrEZ/proxmox-backup-checker.git

# Konfiguration erstellen
wget https://raw.githubusercontent.com/jokrEZ/proxmox-backup-checker/main/app/config.json.example -O config.json
nano config.json  # Deine Proxmox & Home Assistant Daten eintragen

# AusfÃ¼hren
proxmox-backup-checker
```

ğŸ“‹ **[Detaillierte Installationsanleitung â†’](INSTALL.md)**

## ğŸ§  Wie es funktioniert

### Intelligente PrÃ¼flogik
Das Tool analysiert fÃ¼r jede VM/CT:

1. **ğŸ“… Zeitplan-Compliance** - Ist laut Schedule ein Backup fÃ¤llig?
2. **ğŸ“„ Logfile-Existenz** - Gibt es ein aktuelles Logfile?
3. **â° AktualitÃ¤t** - Wurde das Backup nach dem geplanten Termin erstellt?
4. **âœ… Fehlerfreiheit** - EnthÃ¤lt das Log Fehlermeldungen (ERROR, FAILED, aborted)?

**Nur wenn alle Kriterien fehlschlagen, wird eine Benachrichtigung gesendet!**

### UnterstÃ¼tzte Backup-ZeitplÃ¤ne
- **TÃ¤glich**: `03:00` (jeden Tag um 3:00 Uhr)
- **WÃ¶chentlich**: `sun 01:00` (Sonntags um 1:00 Uhr)
- **Komplex**: Beliebige Kombinationen mÃ¶glich

## âš™ï¸ Konfiguration

Erstelle eine `config.json` mit deinen Daten:

```json
{
    "proxmox_host": "192.168.1.100:8006",
    "proxmox_api_token_user": "root@pam!backup-checker",
    "proxmox_api_token_name": "backup-checker",
    "proxmox_api_token_secret": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    "proxmox_verify_ssl": false,
    "proxmox_backup_dir": "/var/log/vzdump",
    "home_assistant_webhook_url": "https://your-ha.duckdns.org/api/webhook/backup-alerts",
    "debug": false
}
```

### ğŸ”‘ Proxmox API-Token erstellen
1. **Proxmox Web UI** â†’ Datacenter â†’ Permissions â†’ API Tokens
2. **Add** â†’ User: `root@pam`, Token ID: `backup-checker`
3. **Privilege Separation** deaktivieren
4. **Token Secret** kopieren und in config.json eintragen

## ğŸ  Home Assistant Integration

### Webhook einrichten
```yaml
# configuration.yaml
automation:
  - alias: "Proxmox Backup Fehler"
    trigger:
      - platform: webhook
        webhook_id: backup-alerts
    action:
      - service: notify.mobile_app_your_phone
        data:
          title: "ğŸš¨ Proxmox Backup Fehler"
          message: "{{ trigger.json.message }}"
```

### Webhook-URL
`https://your-ha.duckdns.org/api/webhook/backup-alerts`

## ğŸ“Š Beispiel-Ausgabe

### Debug-Modus
```bash
# Debug aktivieren
proxmox-backup-checker  # mit "debug": true in config.json
```

```
[DEBUG] Erfolgreiche Backups (nach Zeitplan):
  - VM/CT-ID: 101 (docker): Backup erfolgreich am 2025-06-24 03:01:58
  - VM/CT-ID: 102 (nextcloud): Backup erfolgreich am 2025-06-24 03:02:40

[DEBUG] Fehlerhafte Backups:
  - VM/CT-ID: 104 (database): Logdatei nicht gefunden
```

### Home Assistant Benachrichtigung
```
ğŸš¨ Proxmox Backup Fehler
Backup-Fehler bei database (ID: 104): Logdatei nicht gefunden
```

## ğŸ”§ Entwicklung & BeitrÃ¤ge

```bash
# Repository fÃ¼r Entwicklung klonen
git clone https://github.com/jokrEZ/proxmox-backup-checker.git
cd proxmox-backup-checker

# Development-Installation
pip install -e .[dev]

# Code-QualitÃ¤t prÃ¼fen
black app/
isort app/
flake8 app/
```

**BeitrÃ¤ge sind willkommen!** ğŸ‰ Bitte erstelle einen Pull Request oder Ã¶ffne ein Issue.

## ğŸ“„ Lizenz

MIT License - siehe [LICENSE](LICENSE) fÃ¼r Details.

---

**â­ Hat dir das Tool geholfen? Gib dem Repository einen Stern!** 